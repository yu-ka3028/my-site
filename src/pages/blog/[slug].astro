---
import Layout from '../../layouts/Layout.astro'
import { getCollection, render } from 'astro:content'
import { getCategoryLabel } from '../../lib/categories'
import type { CategorySlug } from '../../lib/categories'

export async function getStaticPaths() {
  const posts = await getCollection('blog')
  return posts.map(post => ({
    params: { slug: post.id },
    props: { post },
  }))
}

const { post } = Astro.props
const { Content } = await render(post)
---

<Layout title={`${post.data.title} | My Site`} description={post.data.description}>
  <div class="max-w-5xl mx-auto px-8 py-16">
    <article class="max-w-2xl">
      <header class="mb-12">
        <a href="/blog" class="text-xs text-muted hover:text-brand transition-colors font-semibold">
          ‚Üê Blog
        </a>
        <h1 class="text-3xl font-extrabold text-text mt-6 leading-snug">{post.data.title}</h1>
        <p class="text-sm text-muted mt-3 font-medium">
          {post.data.pubDate.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })}
        </p>
        <div class="flex flex-wrap items-center gap-2 mt-4">
          {post.data.category && (
            <a
              href={post.data.subcategory
                ? `/blog/category/${post.data.category}/${post.data.subcategory}`
                : `/blog/category/${post.data.category}`}
              class="text-xs px-3 py-1 bg-brand/10 border border-brand/30 text-brand rounded-full font-semibold hover:bg-brand/20 transition-colors"
            >
              {getCategoryLabel(post.data.category as CategorySlug)}
              {post.data.subcategory && ` / ${post.data.subcategory}`}
            </a>
          )}
          {post.data.tags && post.data.tags.map(tag => (
            <span class="text-xs px-3 py-1 bg-surface border border-border text-muted rounded-full font-semibold">
              {tag}
            </span>
          ))}
        </div>
      </header>
      <div class="prose max-w-none
        [--tw-prose-body:#f5e6d3]
        [--tw-prose-headings:#fdf0e0]
        [--tw-prose-links:#e8703a]
        [--tw-prose-bold:#fdf0e0]
        [--tw-prose-code:#e8703a]
        [--tw-prose-pre-bg:#241a0f]
        [--tw-prose-pre-code:#f5e6d3]
        [--tw-prose-quotes:#9b7d5e]
        [--tw-prose-quote-borders:#e8703a]
        [--tw-prose-hr:#3d2b1a]
        [--tw-prose-bullets:#9b7d5e]">
        <Content />
      </div>
    </article>
  </div>
</Layout>
